# Привилегии
## Получение информации о своей идентичности
```sh
$ id
uid=1000(vboxuser) gid=1000(vboxuser) groups=1000(vboxuser),100(users)
```
* `uid` - идентификатор пользователя (user ID)
* `gid` - идентификатор группы пользователя (**primary** group ID)
* `groups` - группы, в которые входит пользователь

*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 124*

### Основная группа
Несмотря на то, что во многих UNIX-подобных системах пользователей обычно включают в обзую группу (к примеру, `users`), в современных дистрибутивах Linux принято создавать для каждого пользователя свою уникальную группу с одним членом и именем, равным имени пользователя. <br/>
Это облегчает распределение определенных типов привилегий<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 125*

### Нумерация UID
В Fedora, нумерация идентификаторов пользователей обычно начинается с `500`, а в Ubuntu - с `1000`<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 125*

## Место хранение учетных записей и групп
Учетные записи хранятся в `/etc/passwd`, группы - в `/etc/group`, а пароли - в `/etc/shadow`<br/>
```shell
$ tail /etc/passwd | grep vboxuser
vboxuser:x:1000:1000:vboxuser,,,:/home/vboxuser:/bin/bash
$ less /etc/group | grep vboxuser
sudo:x:27:vboxuser
users:x:100:vboxuser
vboxuser:x:1000:
$ sudo tail /etc/shadow | grep vboxuser
vboxuser:$y$j9T$iK...dC7:20013:0:99999:7:::
```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 125*

### Что хранится в /etc/passwd
Для каждой учетной записи в `/etc/passwd` указывается:<br/>
* `uid`
* `gid` (основная группы)
* имя пользователя
* домашний каталог
* `login shell` (командная оболочка)
* 
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 125*

## ls -l. Первый символ в выводе, перед аттрибутами прав доступа
| Атрибут | Тип файла                                                                                                                                                                                                                |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `-`     | **Обычный файл**                                                                                                                                                                                                         |
| `d`     | **Каталог**                                                                                                                                                                                                              |
| `l`     | **Символическая ссылка.**<br/>При этом, остальные аттрибуты доступа будут иметь вид `rwxrwxrwx` и не будут отражать действительных прав доступа.<br/>чтобы посмотреть действительные права, нужно съодить к самому файлу |
| `c`     | **Специальный символ**<br/>Фацлы этого типа соответствуют устройствам (модем, терминал), которые обрабатывают потоки байтов                                                                                              |
| `b`     | **Специальный файл блочного устройства**<br/>Привод HDD, CD-ROM и другие, которые обрабатывают данные блоками                                                                                                            |
```shell
$ ls -l ~
total 32
drwxr-xr-x 2 vboxuser vboxuser 4096 Oct 17 12:18 Desktop
drwxr-xr-x 2 vboxuser vboxuser 4096 Oct 17 12:18 Documents
...
```
Тут первый символ `d` - каталог
```shell
$ ls -l
total 1056
-rw-r--r--  1 root root    3040 May 25  2023 adduser.conf
-rw-r--r--  1 root root      44 Oct 17 12:10 adjtime
...
lrwxrwxrwx  1 root root      33 Oct 17 11:57 localtime -> /usr/share/zoneinfo/Europe/Moscow
...
```
Тут у первых файлов первый символ `-` - обычный файл, а у `localtime` первый символ `l`, а права доступа не отражают действительность<br/>
Настоящие права на файл, на который ссылается ссылка такие
```shell
$ ls -l /usr/share/zoneinfo/Europe/Moscow
-rw-r--r-- 1 root root 1535 Feb  3  2024 /usr/share/zoneinfo/Europe/Moscow
```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 126*

## ls -l. Аттрибуты прав доступа
Аттрибуты идут в порядке **ВладелецГруппаОстальные**<br/>

| Аттрибут | Права на файл                                                                                                                                                                                  | Права на каталог                                                                                                             |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|
| `r`      | Разрешается ткрытие и чтение содержимого файла                                                                                                                                                 | Разрешается чтение содержимого каталога, если с этим аттрибутом установлен аттрибут `x`                                      |
| `w`      | Разрешается записывать в файл, но нельзя переименовывать и удалять файл.<br/>Переименование и удаление файлов определяется аттрибутами внешнего каталога                                       | Разрешается создавать, удалять, переименовывать файлы внутри каталога, если вместе с этим аттрибутом установлен аттрибут `x` |
| `x`       | Разрешает интерпретировать файл, как программу и выполнять ее.<br/>Файлы, содержащие программы на языках сценариев должны быть одновременно доступны для чтения иначе они не будут выполняться | Разрешается входить в каталог (выполнять `cd` для перехода в него)                                                           |


*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 126-127*

## Изменение прав доступа. chmod
Для изменения прав доступа к файлу или каталогу используется `chmod`<br/>
Менять права может только владелец файла/каталога или **root**<br/>
`chmod` поддерживает 2 способа задачи прав:
* с использованием восьмеричных чисел
* с использованием символического представления

*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 128*

### Маппинг восьмеричного значения на режимы доступа в chmod
| Восьмеричное значение | Режим доступа | Для отслеживания логики -<br/>двоичное представление |
|-----------------------|---------------|------------------------------------------------------|
| `0`                   | `---`         | 000                                                  |
| `1`                   | `--x`         | 001                                                  |
| `2`                   | `-w-`         | 010                                                  |
| `3`                   | `-wx`         | 011                                                  |
| `4`                   | `r--`         | 100                                                  |
| `5`                   | `r-x`         | 101                                                  |
| `6`                   | `rw-`         | 110                                                  |
| `7`                   | `rwx`         | 111                                                  |

Наиболее популярные шаблоны: `7` (`rwx`), `6` (`rw-`), `5` (`r-x`), `4` (`r--`), `0` (`---`)<br/>
```shell
$ ls -l 1.txt
-rw-r--r-- 1 vboxuser vboxuser 73 Oct 18 09:18 1.txt
$ chmod 600 1.txt
$ ls -l 1.txt
-rw------- 1 vboxuser vboxuser   73 Oct 18 09:18 1.txt
```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 128, 130*

### Символическое представление в chmod
```shell
$ chmod g+x 1.txt
$ ls -l 1.txt
-rw---x--- 1 vboxuser vboxuser 73 Oct 18 09:18 1.txt
```
| Сокращение получателя прав | Значение                                 |
|----------------------------|------------------------------------------|
| `u`                        | Владелец файла/ каталога                 |
| `g`                        | Группа                                   |
| `o`                        | Остальные                                |
| `a`                        | Все - владелец, группа, остальные вместе |

Если ни один символ не указать, то будет предполагаться `a`<br/>
При определении можно использовать символы `+`, `-`, `=`<br/>
Примеры:
* `u+x`
* `u-x`
* `+x` (аналог `a+x`, добавляет всем)
* `o+rw`
* `go=rw`
* `u+x,go=rx`

*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 130-131*

### Рекурсивность в chmod
Рекурсивность (`--recursive`) применяется и к файлам, и к каталогам внутри<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 131*

## umask - разрешения по умолчанию
Команда `umask` определяет разрешения по умолчанию, которые устанавливаются для файла при его создании<br/>
```shell
$ umask
0022
$ ls > 1.txt
$ ls -l
total 36
-rw-r--r-- 1 vboxuser vboxuser   73 Oct 19 08:12 1.txt
...
```
без параметров возвращает текущее значение маски<br/>
Там, где маска в `umask` принимает значение - атрибут сбрасывается<br/>

| 0 | 0 | 2 | 2 |
| --- | --- | --- | --- |
| пока не паримся | `rw-` | `r--` | `r--` | 

Что бы поменять маску по умолчанию, нужно передать аргумент в `umask`
```shell
$ umask 0000
$ umask
0000
$ ls > 2.txt
$ ls -l
total 40
-rw-r--r-- 1 vboxuser vboxuser   73 Oct 19 08:12 1.txt
-rw-rw-rw- 1 vboxuser vboxuser   79 Oct 19 08:14 2.txt
...
```
| 0 | 0 | 0 | 0     |
| --- | --- |-------|-------|
| пока не паримся | `rw-` | `rw-` | `rw-` | 

Теперь все по нулям и ничто не сброшено, всем доступны чтение и запись
```shell
$ umask 0777
$ ls > 3.txt
$ ls -l
total 44
-rw-r--r-- 1 vboxuser vboxuser   73 Oct 19 08:12 1.txt
-rw-rw-rw- 1 vboxuser vboxuser   79 Oct 19 08:14 2.txt
---------- 1 vboxuser vboxuser   85 Oct 19 08:24 3.txt
```
| 0 | 7     | 7     | 7     |
| --- |-------|-------|-------|
| пока не паримся | `---` | `---` | `---` | 

```shell
$ umask 0111
$ ls > 4.txt
$ ls -l
total 48
-rw-r--r-- 1 vboxuser vboxuser   73 Oct 19 08:12 1.txt
-rw-rw-rw- 1 vboxuser vboxuser   79 Oct 19 08:14 2.txt
---------- 1 vboxuser vboxuser   85 Oct 19 08:24 3.txt
-rw-rw-rw- 1 vboxuser vboxuser   91 Oct 19 08:26 4.txt
```
Проставленные `1` дают тот же эффект, что и `0`<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 132-133*

### umask - специальный разрешения (первый агрумент)
* `setuid` (`4000`) - если он выставлен, то при выполнении для процесса подставляется не UID пользователя, который запустил процесс, а UID владельца программы. К примеру, если владелец - `root`, программа будет иметь расшренный доступ
* `setgid` (`2000`) - аналогично `setuid`, только для группы
* `sticky` (`1000`) - пережиток прошлого. Для файлов игнорируется, а для каталогов не позволяет удалять или переименовывать содержимое, если пользователь не является владельцем. Бывает, применяется к `/tmp`

*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 134*

### chmod и специальные разрешения
#### setuid
```shell
$ chmod u+s 1.txt
$ ls -l 1.txt
-rwSr--r-- 1 vboxuser vboxuser 73 Oct 19 08:12 1.txt
```
#### setgid
```shell
$ chmod g+s 1.txt
$ ls -l 1.txt
-rwSr-Sr-- 1 vboxuser vboxuser 73 Oct 19 08:12 1.txt
```
#### sticky
```shell
$ mkdir tmp
$ ls -l
total 52
...
drwxr-xr-x 2 vboxuser vboxuser 4096 Oct 19 08:51 tmp
$ chmod +t tmp
$ ls -l
total 52
...
drwxr-xr-t 2 vboxuser vboxuser 4096 Oct 19 08:51 tmp

```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 134-135*

## Конфигурация разрешений на выполнение команд sudo в /etc/sudoers
Команда `sudo` позволяет администратору записать настройки в конфиг `/etc/sudoers` и определить конкретные команды, которые сможет выполнять тот или иной пользователь<br/>

*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 135*