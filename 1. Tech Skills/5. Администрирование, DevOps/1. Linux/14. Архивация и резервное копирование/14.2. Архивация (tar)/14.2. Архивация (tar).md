# Архивация (tar)
**Архивация** - процесс сбора множества файлов и упаковка их в один большой файл.<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 268*

## tar
Классический инструмент архивирования.<br/>
Расшифровывается, как _tape archive_ (архив на магнитной ленте).<br/>
Синтаксис: `tar режим[параметры] путь...`<br/>
**Режим всегда используется первым**, до параметров<br\>
Часто можно видеть файлы с расширением `.tar.gz` - простые tar-архивы, сжатые при помощи `gzip`<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 269*

### Режимы tar
| Режим | Описание                                 |
|-------|------------------------------------------|
| `c`   | Создать архив из списка файлов/каталогов |
| `x`   | Извлечь файлы из архива                  |
| `r`   | Добавить файл/каталог в конец архива     |
| `t`    | Вывести список содержимого архива        |

*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 269*

### Некоторые параметры tar
| Параметр                  | Описание                                 |
| ------------------------- | ---------------------------------------- |
| `v`                       | Отладочная информация                    |
| `f`                       | Определяет имя tar-архива                |
| `--wildcards`             | Позволяет использовать групповые символы |
| `--files-from` (или `-T`) | Источник файлов (к примеру, в конвейере) |
| `z`                       | сжатие gzip                              |
| `j`                       | сжатие bzip2                             |

```shell
akhitev@akhitev-laptop:~/Документы$ ls
sdlc_src   SDLC.pptx
akhitev@akhitev-laptop:~/Документы$ tar cf sdlc_backup.tar sdlc_src/ SDLC.pptx 
akhitev@akhitev-laptop:~/Документы$ tar tf sdlc_backup.tar 
sdlc_src/
sdlc_src/sdlc_1.drawio
SDLC.pptx
```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 269, 270, 271*

## Права на извлеченные файлы
Извлеченные файлы принадлежат не исходному владельцу, а пользователю, которые извлекал файлы.<br/>
Следует учитывать при распаковке от имени `root`-а<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 270*

## Относительные пути
По умолчанию используются относительные пути, а не абсолютные.<br/>
Для этого, `tar` просто удаляет начальный слэш во всех путях.<br/>
Для демонстрации создадим архив с абсолютным путем, а распакуем в другом месте. Восстановится относительно нового места.<br/>
Это позволяет извлекать архивы в любое место, а не только в изначальное.<br/>
```shell
$ ls
sdlc_backup.tar
$ tar xvf ./sdlc_backup.tar 
sdlc_src/
sdlc_src/sdlc_1.drawio
SDLC.pptx
$ ls
sdlc_backup.tar  SDLC.pptx  sdlc_src
```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 270, 271*

## Конвейер с find
`tar` способна использовать стандартные ввод/вывод.
К примеру, `find` может передать список найденных файлов по конвейеру, который принимает его, а свой вывод передает в `gzip`
```sh
$ find . -name "ls-output*" | tar cf - --files-from=- | gzip > ls-output.tgz
```
Знак `-` подразумевается стандартный ввод/вывод.<br/>
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 272*

### Конвейер с find для backup-ов
Использование `tar` в сочетании с `find` предоставляет отличный способ **инкрементального резервного копирования** дерева каталогов или всей системы.<br/> 
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 272*

## Ключи для сжатия в современных версиях
Современный GNU-версии `tar` поддерживают возможность `gzip` и `bzip2` сжатия своими внутренними средствами, для чего служат параметры `z` и `j` соответственно.
```shell
$ find . -name "ls-output*" | tar czf ls-output.tgz -T -
$ find . -name "ls-output*" | tar cjf ls-output.tbz -T -
```
*Командная строка Linux. Полное руководство. 2-е межд. изд., стр. 273*

